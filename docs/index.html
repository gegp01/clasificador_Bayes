<!DOCTYPE html>
<html>
    <head>
        <title>datos</title>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width">
        <link rel="stylesheet" type="text/css" href="css/bootstrap.css">

        <style>
            
            .card {
                box-shadow: 0 12px 16px 0 rgba(0,0,0,0.24), 0 17px 50px 0 rgba(0,0,0,0.19);
                background:#f4f6f7;
            }

            .card:hover {
                background:white;
            }

          .indented {
          padding-left: 3%;
          padding-right: 0.5%;
          }

          pre {
            background: #3e484f;
            border: 1px solid #ddd;
            // border-left: 3px solid #f36d33;
            color: white;
            page-break-inside: avoid;
            font-family: monospace;
            font-size: 15px;
            line-height: 1.6;
            margin-bottom: 1.6em;
            max-width: 100%;
            overflow: auto;
            padding: 1em 1.5em;
            display: block;
            word-wrap: break-word;
            }

        </style>
    
    </head>
    <body>
    
<div style="max-width:800px;"><h4>Compilador de datos para el análisis de COVID-19 en México</h4>

    <figure>
        <figcaption> 1. Para cosechar los datos del reporte de diario de la Dirección general de Epidemiología se puede utilizar la siguiente instrucción:</figcaption>
        <pre>
        <code>
        source("https://gegp01.github.io/clasificador_Bayes/R/datos_DGE.R")
        </code>
        </pre>
    </figure>
    
    <figure>
        <figcaption> El código cosecha la información oficial, guarda una copia y la almacena en un directorio local.
            El documento datos_DGE.R tiene las siguientes instrucciones, que se ejecutan al leer el codigo en la dirección url.</figcaption>
        <pre>
        <code>
            # CREAR UN DIRECTORIO TEMPORAL
              td = tempdir()

            # create the placeholder file
            # GENERAR UN ARCHIVO TEMPORAL
              tf = tempfile(tmpdir=td, fileext=".zip")

            # DESCARGAR LOS DATOS DEL URL EN EL ARCHIVO TEMPORAL
              download.file("http://datosabiertos.salud.gob.mx/gobmx/salud/datos_abiertos/datos_abiertos_covid19.zip", tf)
              #download.file("http://epidemiologia.salud.gob.mx/gobmx/salud/datos_abiertos/datos_abiertos_covid19.zip", tf)
              # download.file("http://187.191.75.115/gobmx/salud/datos_abiertos/datos_abiertos_covid19.zip", tf) # cambio la dirección! 31/jul/2020

            # LEER EL NOMBRE DEL PRIMER DOCUMENTO EN EL ARCHIVO ZIP.
              fname = unzip(tf, list=TRUE)$Name[1]

            # EXTRAER EL DOCUMENTO Y GUARDARLO EN EL DIRECTORIO TEMPORAL
              unzip(tf, files=fname, exdir=td, overwrite=TRUE)

            # OBTENER LA RUTA AL DOCUMENTO (fpath)
              fpath = file.path(td, fname)

            # LEER LAS PRIMERAS FILAS DEL DOCUMENTO EN fpath PARA SABER SUS DIMENSIONES (filas, coumnas) 
              d = read.csv(fpath, header=TRUE, row.names=NULL, stringsAsFactors=FALSE, nrows=10) 
              q<-ncol(d) # NUMERO DE COLUMNAS EN EL DOCUMENTO

            # LEER TODO EL DOCUMENTO, ASIGNANDO LA CLASE CARACTER PARA TODAS LAS COLUMNAS. ESTO PERMITE MANTENER LA INTEGRIDAD DEL CODIGO DE MUNICIPIO (MUCIPIO_OFICIA)
              covid = read.csv(fpath, header=TRUE, row.names=NULL, stringsAsFactors=FALSE, colClasses=c(rep("character",q))) 

              print("LISTO! LOS DATOS ESTÁN EN EL DATAFRAME covid")
         </code>
       </pre>
     </figure>

    </div>
    </body>
</html>



